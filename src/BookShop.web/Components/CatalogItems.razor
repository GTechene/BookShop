@inject CatalogHttpClient CatalogHttpClient

@if (CatalogToDisplay is null)
{
    <Loading />
    return;
}

@if (CatalogToDisplay.TotalNumberOfPages > 1)
{
    <CatalogPager CurrentPage="@_currentPage" TotalNumberOfPages="CatalogToDisplay.TotalNumberOfPages" OnPageSelected="@ChangePage"/>
}
@foreach (var book in CatalogToDisplay.Books)
{
    <CatalogItem
        BookToDisplay="@book"
        OnBookAdded="@SelectBook"
        CanBeSelected="@(CanSelectBook(book))"/>
}


@code {
    private CatalogModel? CatalogToDisplay { get; set; }
    private int _currentPage = 1;

    [Parameter]
    public EventCallback<BookModel> OnBookSelected { get; set; }

    [Parameter]
    public Predicate<BookModel> CanSelectBook { get; set; } = null!;

    protected override async Task OnInitializedAsync()
    {
        CatalogToDisplay = await CatalogHttpClient.GetCatalog();
    }

    private async Task ChangePage(int pageToRequest)
    {
        CatalogToDisplay = await CatalogHttpClient.GetCatalog(pageToRequest);
        _currentPage = pageToRequest;
    }


    private async Task SelectBook(BookModel book)
    {
        await OnBookSelected.InvokeAsync(book);
    }
}